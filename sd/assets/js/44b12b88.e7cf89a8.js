"use strict";(globalThis.webpackChunkrobotics_book=globalThis.webpackChunkrobotics_book||[]).push([[5896],{4272:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"module2-simulation/physics-simulation","title":"Physics Simulation","description":"Understanding physics engines and simulating humanoid dynamics","source":"@site/docs/module2-simulation/physics-simulation.md","sourceDirName":"module2-simulation","slug":"/module2-simulation/physics-simulation","permalink":"/docusaurus-robotics-book/sd/module2-simulation/physics-simulation","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1764862720000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Physics Simulation","description":"Understanding physics engines and simulating humanoid dynamics","keywords":["physics simulation","ODE","dynamics","collision","humanoid balance"]},"sidebar":"tutorialSidebar","previous":{"title":"Gazebo Simulation Setup","permalink":"/docusaurus-robotics-book/sd/module2-simulation/gazebo-setup"},"next":{"title":"Unity for Robot Visualization","permalink":"/docusaurus-robotics-book/sd/module2-simulation/unity-rendering"}}');var r=i(4848),l=i(8453);const o={sidebar_position:2,title:"Physics Simulation",description:"Understanding physics engines and simulating humanoid dynamics",keywords:["physics simulation","ODE","dynamics","collision","humanoid balance"]},t="Physics Simulation for Humanoids",c={},a=[{value:"Why Physics Simulation?",id:"why-physics-simulation",level:2},{value:"Physics Engines",id:"physics-engines",level:2},{value:"Selecting Physics Engine",id:"selecting-physics-engine",level:3},{value:"Physics Parameters",id:"physics-parameters",level:2},{value:"Time Stepping",id:"time-stepping",level:3},{value:"Real-Time Factor",id:"real-time-factor",level:3},{value:"Gravity",id:"gravity",level:3},{value:"Contact Dynamics",id:"contact-dynamics",level:2},{value:"Friction",id:"friction",level:3},{value:"Contact Stiffness and Damping",id:"contact-stiffness-and-damping",level:3},{value:"Bounce (Restitution)",id:"bounce-restitution",level:3},{value:"Joint Dynamics",id:"joint-dynamics",level:2},{value:"Joint Damping",id:"joint-damping",level:3},{value:"Joint Friction",id:"joint-friction",level:3},{value:"Joint Limits",id:"joint-limits",level:3},{value:"Inertial Properties",id:"inertial-properties",level:2},{value:"Why Inertia Matters",id:"why-inertia-matters",level:3},{value:"Calculating Inertia",id:"calculating-inertia",level:3},{value:"Example: Torso Link",id:"example-torso-link",level:3},{value:"Tools for Complex Meshes",id:"tools-for-complex-meshes",level:3},{value:"Simulating Balance and Walking",id:"simulating-balance-and-walking",level:2},{value:"Center of Mass (CoM)",id:"center-of-mass-com",level:3},{value:"Zero Moment Point (ZMP)",id:"zero-moment-point-zmp",level:3},{value:"Ground Contact Forces",id:"ground-contact-forces",level:3},{value:"Advanced: Joint Controllers",id:"advanced-joint-controllers",level:2},{value:"Position Control",id:"position-control",level:3},{value:"Effort (Torque) Control",id:"effort-torque-control",level:3},{value:"Debugging Physics Issues",id:"debugging-physics-issues",level:2},{value:"Robot Falls Through Ground",id:"robot-falls-through-ground",level:3},{value:"Robot Vibrates/Explodes",id:"robot-vibratesexplodes",level:3},{value:"Joints Don&#39;t Move",id:"joints-dont-move",level:3},{value:"Feet Slip",id:"feet-slip",level:3},{value:"Noise Models",id:"noise-models",level:2},{value:"Performance: Real-Time vs. Faster",id:"performance-real-time-vs-faster",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Lab Exercise",id:"lab-exercise",level:2}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"physics-simulation-for-humanoids",children:"Physics Simulation for Humanoids"})}),"\n",(0,r.jsx)(e.h2,{id:"why-physics-simulation",children:"Why Physics Simulation?"}),"\n",(0,r.jsxs)(e.p,{children:["Humanoid robots are ",(0,r.jsx)(e.strong,{children:"dynamic systems"})," governed by physics:"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Gravity"})," pulls them down"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Friction"})," determines slipping"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Collisions"})," with ground and obstacles"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Inertia"})," affects movement and balance"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Joint dynamics"})," (motors, damping, friction)"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"Accurate simulation is critical for:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Testing without hardware"}),": Develop algorithms before deploying"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Safety"}),": Debug dangerous scenarios (falling, collisions) safely"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Sim-to-real transfer"}),": Train neural networks in simulation, deploy to robot"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Rapid iteration"}),": Test 100x faster than real-time"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"physics-engines",children:"Physics Engines"}),"\n",(0,r.jsx)(e.p,{children:"Gazebo supports multiple physics engines:"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Engine"}),(0,r.jsx)(e.th,{children:"Strengths"}),(0,r.jsx)(e.th,{children:"Weaknesses"}),(0,r.jsx)(e.th,{children:"Use Case"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"ODE"})}),(0,r.jsx)(e.td,{children:"Fast, stable, default in Gazebo"}),(0,r.jsx)(e.td,{children:"Less accurate contacts"}),(0,r.jsx)(e.td,{children:"General robotics"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Bullet"})}),(0,r.jsx)(e.td,{children:"Good collision detection"}),(0,r.jsx)(e.td,{children:"Can be unstable"}),(0,r.jsx)(e.td,{children:"Multi-body dynamics"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Dart"})}),(0,r.jsx)(e.td,{children:"Accurate, good for humanoids"}),(0,r.jsx)(e.td,{children:"Slower"}),(0,r.jsx)(e.td,{children:"Precise simulation, research"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Simbody"})}),(0,r.jsx)(e.td,{children:"High accuracy"}),(0,r.jsx)(e.td,{children:"Complex setup"}),(0,r.jsx)(e.td,{children:"Biomechanics"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"For humanoids"}),": ",(0,r.jsx)(e.strong,{children:"DART"})," is recommended for accuracy, ",(0,r.jsx)(e.strong,{children:"ODE"})," for speed."]}),"\n",(0,r.jsx)(e.h3,{id:"selecting-physics-engine",children:"Selecting Physics Engine"}),"\n",(0,r.jsx)(e.p,{children:"In world file:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<world name="humanoid_world">\n  <physics type="dart">  \x3c!-- or "ode", "bullet" --\x3e\n    <max_step_size>0.001</max_step_size>\n    <real_time_factor>1.0</real_time_factor>\n  </physics>\n</world>\n'})}),"\n",(0,r.jsx)(e.h2,{id:"physics-parameters",children:"Physics Parameters"}),"\n",(0,r.jsx)(e.h3,{id:"time-stepping",children:"Time Stepping"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"max_step_size"}),": How often physics is updated"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<physics type="ode">\n  <max_step_size>0.001</max_step_size>  \x3c!-- 1ms, 1000 Hz --\x3e\n  <real_time_update_rate>1000</real_time_update_rate>\n</physics>\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Trade-offs"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Smaller step"})," (0.0001): More accurate, slower"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Larger step"})," (0.01): Faster, less accurate, can be unstable"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Humanoid recommendation"}),": 0.001 (1 kHz) for balance, 0.002 for efficiency."]}),"\n",(0,r.jsx)(e.h3,{id:"real-time-factor",children:"Real-Time Factor"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"real_time_factor"}),": Simulation speed relative to real-time"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:"<real_time_factor>1.0</real_time_factor>  \x3c!-- 1x real-time --\x3e\n<real_time_factor>0.5</real_time_factor>  \x3c!-- 2x slower (more accurate) --\x3e\n<real_time_factor>2.0</real_time_factor>  \x3c!-- 2x faster (if CPU allows) --\x3e\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Note"}),": If simulation is heavy, actual speed may be slower than target."]}),"\n",(0,r.jsx)(e.h3,{id:"gravity",children:"Gravity"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:"<gravity>0 0 -9.81</gravity>  \x3c!-- Earth gravity (m/s\xb2) --\x3e\n"})}),"\n",(0,r.jsx)(e.p,{children:"Custom gravity for testing:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:"<gravity>0 0 -3.71</gravity>  \x3c!-- Mars gravity --\x3e\n<gravity>0 0 -1.62</gravity>  \x3c!-- Moon gravity --\x3e\n"})}),"\n",(0,r.jsx)(e.h2,{id:"contact-dynamics",children:"Contact Dynamics"}),"\n",(0,r.jsx)(e.h3,{id:"friction",children:"Friction"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Critical for humanoids"}),": Feet must not slip on ground."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:"<surface>\n  <friction>\n    <ode>\n      <mu>1.0</mu>    \x3c!-- Friction coefficient (0-inf) --\x3e\n      <mu2>1.0</mu2>  \x3c!-- Secondary friction direction --\x3e\n    </ode>\n  </friction>\n</surface>\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Friction coefficients"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"mu = 0"}),": Frictionless (ice)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"mu = 0.5"}),": Low friction (wet surface)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"mu = 1.0"}),": Normal (concrete, rubber)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"mu = 2.0"}),": High friction (rubber on rubber)"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Example"}),": High-friction feet"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<link name="right_foot">\n  <collision name="collision">\n    <geometry>\n      <box size="0.2 0.1 0.05"/>\n    </geometry>\n    <surface>\n      <friction>\n        <ode>\n          <mu>1.5</mu>   \x3c!-- Prevent slipping --\x3e\n          <mu2>1.5</mu2>\n        </ode>\n      </friction>\n    </surface>\n  </collision>\n</link>\n'})}),"\n",(0,r.jsx)(e.h3,{id:"contact-stiffness-and-damping",children:"Contact Stiffness and Damping"}),"\n",(0,r.jsx)(e.p,{children:'Controls "softness" of collisions:'}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:"<surface>\n  <contact>\n    <ode>\n      <kp>1000000.0</kp>  \x3c!-- Contact stiffness (N/m) --\x3e\n      <kd>1.0</kd>        \x3c!-- Contact damping (N\xb7s/m) --\x3e\n    </ode>\n  </contact>\n</surface>\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Higher kp"}),": Harder contacts (less penetration, more bounce)\n",(0,r.jsx)(e.strong,{children:"Lower kp"}),": Softer contacts (some penetration, less bounce)"]}),"\n",(0,r.jsx)(e.h3,{id:"bounce-restitution",children:"Bounce (Restitution)"}),"\n",(0,r.jsx)(e.p,{children:"How much energy is preserved in collisions:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:"<surface>\n  <bounce>\n    <restitution_coefficient>0.0</restitution_coefficient>  \x3c!-- 0-1 --\x3e\n    <threshold>0.01</threshold>  \x3c!-- Min velocity for bounce --\x3e\n  </bounce>\n</surface>\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"restitution = 0.0"}),": Inelastic (no bounce)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"restitution = 0.5"}),": Loses 50% energy"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"restitution = 1.0"}),": Perfectly elastic (bounce forever)"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Humanoid feet"}),": Use 0.0 (no bounce, stable standing)."]}),"\n",(0,r.jsx)(e.h2,{id:"joint-dynamics",children:"Joint Dynamics"}),"\n",(0,r.jsx)(e.h3,{id:"joint-damping",children:"Joint Damping"}),"\n",(0,r.jsx)(e.p,{children:"Resists motion (like viscous friction):"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<joint name="knee_pitch" type="revolute">\n  \x3c!-- ... --\x3e\n  <dynamics>\n    <damping>0.7</damping>  \x3c!-- N\xb7m\xb7s/rad --\x3e\n  </dynamics>\n</joint>\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Effect"}),": Higher damping = slower, more controlled motion."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Typical values"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Small joints (fingers): 0.1-0.3"}),"\n",(0,r.jsx)(e.li,{children:"Medium joints (elbows, knees): 0.5-1.0"}),"\n",(0,r.jsx)(e.li,{children:"Large joints (hips, shoulders): 1.0-2.0"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"joint-friction",children:"Joint Friction"}),"\n",(0,r.jsx)(e.p,{children:"Static friction at joint:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:"<dynamics>\n  <friction>0.1</friction>  \x3c!-- N\xb7m --\x3e\n</dynamics>\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Effect"}),": Minimum torque to start moving joint."]}),"\n",(0,r.jsx)(e.h3,{id:"joint-limits",children:"Joint Limits"}),"\n",(0,r.jsx)(e.p,{children:"Enforce physical constraints:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<joint name="knee_pitch" type="revolute">\n  <axis xyz="0 1 0"/>\n  <limit>\n    <lower>0.0</lower>       \x3c!-- Fully extended --\x3e\n    <upper>2.5</upper>       \x3c!-- Max flexion (rad) --\x3e\n    <effort>100.0</effort>   \x3c!-- Max torque (N\xb7m) --\x3e\n    <velocity>5.0</velocity> \x3c!-- Max angular velocity (rad/s) --\x3e\n  </limit>\n</joint>\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Safety"}),": Prevents unrealistic poses and motor overload."]}),"\n",(0,r.jsx)(e.h2,{id:"inertial-properties",children:"Inertial Properties"}),"\n",(0,r.jsx)(e.h3,{id:"why-inertia-matters",children:"Why Inertia Matters"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Incorrect inertia"})," \u2192 Unstable simulation"]}),"\n",(0,r.jsx)(e.p,{children:"Mass and inertia determine:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"How much force/torque is needed to move"}),"\n",(0,r.jsx)(e.li,{children:"Rotational dynamics (spinning, tipping)"}),"\n",(0,r.jsx)(e.li,{children:"Balance stability"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"calculating-inertia",children:"Calculating Inertia"}),"\n",(0,r.jsx)(e.p,{children:"For basic shapes:"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Box"})," (dimensions: x, y, z):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"ixx = (1/12) * m * (y\xb2 + z\xb2)\niyy = (1/12) * m * (x\xb2 + z\xb2)\nizz = (1/12) * m * (x\xb2 + y\xb2)\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cylinder"})," (radius: r, height: h, along z-axis):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"ixx = (1/12) * m * (3r\xb2 + h\xb2)\niyy = (1/12) * m * (3r\xb2 + h\xb2)\nizz = (1/2) * m * r\xb2\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Sphere"})," (radius: r):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"ixx = iyy = izz = (2/5) * m * r\xb2\n"})}),"\n",(0,r.jsx)(e.h3,{id:"example-torso-link",children:"Example: Torso Link"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<link name="torso">\n  <inertial>\n    <origin xyz="0 0 0.3" rpy="0 0 0"/>  \x3c!-- Center of mass --\x3e\n    <mass value="10.0"/>  \x3c!-- 10 kg --\x3e\n\n    \x3c!-- Box: 0.3 x 0.2 x 0.6 (width, depth, height) --\x3e\n    <inertia\n      ixx="0.35"  \x3c!-- (1/12)*10*(0.2\xb2+0.6\xb2) --\x3e\n      ixy="0.0"\n      ixz="0.0"\n      iyy="0.4"   \x3c!-- (1/12)*10*(0.3\xb2+0.6\xb2) --\x3e\n      iyz="0.0"\n      izz="0.13"  \x3c!-- (1/12)*10*(0.3\xb2+0.2\xb2) --\x3e\n    />\n  </inertial>\n</link>\n'})}),"\n",(0,r.jsx)(e.h3,{id:"tools-for-complex-meshes",children:"Tools for Complex Meshes"}),"\n",(0,r.jsx)(e.p,{children:"For complex shapes (3D models):"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"MeshLab"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Import mesh (STL, OBJ)"}),"\n",(0,r.jsx)(e.li,{children:"Filters \u2192 Quality Measure \u2192 Compute Geometric Measures"}),"\n",(0,r.jsx)(e.li,{children:"Outputs mass, center of mass, inertia tensor"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"SolidWorks/Fusion 360"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"CAD software automatically calculates inertial properties"}),"\n",(0,r.jsx)(e.li,{children:"Export URDF with correct inertia"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"meshlab-inertia"})," (Python script):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"pip install trimesh\npython compute_inertia.py model.stl --mass 2.0\n"})}),"\n",(0,r.jsx)(e.h2,{id:"simulating-balance-and-walking",children:"Simulating Balance and Walking"}),"\n",(0,r.jsx)(e.h3,{id:"center-of-mass-com",children:"Center of Mass (CoM)"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Key for humanoids"}),": CoM must stay over support polygon (feet)."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Visualize CoM"})," in Gazebo:"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"View \u2192 Center of Mass"}),"\n",(0,r.jsx)(e.li,{children:"Green sphere shows CoM location"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"zero-moment-point-zmp",children:"Zero Moment Point (ZMP)"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"ZMP"}),": Point on ground where net moment is zero."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Stable walking"}),": ZMP stays inside support polygon."]}),"\n",(0,r.jsx)(e.p,{children:"Gazebo doesn't calculate ZMP directly, but you can:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Get link states via ",(0,r.jsx)(e.code,{children:"/gazebo/link_states"})]}),"\n",(0,r.jsx)(e.li,{children:"Calculate CoM from link masses and positions"}),"\n",(0,r.jsx)(e.li,{children:"Project CoM onto ground plane"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"ground-contact-forces",children:"Ground Contact Forces"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Check if feet are on ground"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom gazebo_msgs.msg import ContactsState\n\nclass FootContactNode(Node):\n    def __init__(self):\n        super().__init__('foot_contact')\n\n        self.contact_sub = self.create_subscription(\n            ContactsState,\n            '/foot_contact',\n            self.contact_callback,\n            10\n        )\n\n    def contact_callback(self, msg):\n        if len(msg.states) > 0:\n            self.get_logger().info('Foot in contact with ground')\n            # Access force: msg.states[0].total_wrench.force\n        else:\n            self.get_logger().warn('Foot in air!')\n"})}),"\n",(0,r.jsx)(e.p,{children:"Add contact sensor to foot:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<gazebo reference="right_foot">\n  <sensor name="foot_contact_sensor" type="contact">\n    <contact>\n      <collision>right_foot_collision</collision>\n    </contact>\n    <plugin name="gazebo_ros_bumper" filename="libgazebo_ros_bumper.so">\n      <ros>\n        <namespace>/foot</namespace>\n      </ros>\n      <frame_name>right_foot</frame_name>\n    </plugin>\n  </sensor>\n</gazebo>\n'})}),"\n",(0,r.jsx)(e.h2,{id:"advanced-joint-controllers",children:"Advanced: Joint Controllers"}),"\n",(0,r.jsx)(e.h3,{id:"position-control",children:"Position Control"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"PID controller"})," to reach target joint position:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<gazebo>\n  <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">\n    <robotNamespace>/</robotNamespace>\n  </plugin>\n</gazebo>\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Controller config"})," (",(0,r.jsx)(e.code,{children:"controllers.yaml"}),"):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"joint_state_controller:\n  type: joint_state_controller/JointStateController\n  publish_rate: 50\n\nposition_controller:\n  type: effort_controllers/JointGroupPositionController\n  joints:\n    - right_hip_pitch\n    - right_knee_pitch\n    - right_ankle_pitch\n    - left_hip_pitch\n    - left_knee_pitch\n    - left_ankle_pitch\n"})}),"\n",(0,r.jsx)(e.h3,{id:"effort-torque-control",children:"Effort (Torque) Control"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Direct torque control"})," (for advanced control algorithms):"]}),"\n",(0,r.jsxs)(e.p,{children:["Publish to ",(0,r.jsx)(e.code,{children:"/joint_name/command"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from std_msgs.msg import Float64\n\ntorque_pub = self.create_publisher(Float64, '/right_hip_pitch/command', 10)\ntorque_msg = Float64()\ntorque_msg.data = 50.0  # 50 N\xb7m\ntorque_pub.publish(torque_msg)\n"})}),"\n",(0,r.jsx)(e.h2,{id:"debugging-physics-issues",children:"Debugging Physics Issues"}),"\n",(0,r.jsx)(e.h3,{id:"robot-falls-through-ground",children:"Robot Falls Through Ground"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cause"}),": Collision geometry missing or wrong."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Fix"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Ensure ",(0,r.jsx)(e.code,{children:"<collision>"})," elements exist"]}),"\n",(0,r.jsxs)(e.li,{children:["Check ",(0,r.jsx)(e.code,{children:"check_urdf"})," output"]}),"\n",(0,r.jsx)(e.li,{children:"Verify ground plane in world file"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"robot-vibratesexplodes",children:"Robot Vibrates/Explodes"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cause"}),": Physics instability (timestep too large, inertia wrong)."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Fix"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Reduce ",(0,r.jsx)(e.code,{children:"max_step_size"})," to 0.0005 or 0.001"]}),"\n",(0,r.jsx)(e.li,{children:"Check inertial properties (use realistic values)"}),"\n",(0,r.jsxs)(e.li,{children:["Increase contact stiffness (",(0,r.jsx)(e.code,{children:"kp"}),")"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"joints-dont-move",children:"Joints Don't Move"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cause"}),": Joint limits, missing controller, or high friction."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Fix"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Check joint limits in URDF"}),"\n",(0,r.jsx)(e.li,{children:"Verify controller is loaded"}),"\n",(0,r.jsxs)(e.li,{children:["Reduce ",(0,r.jsx)(e.code,{children:"damping"})," and ",(0,r.jsx)(e.code,{children:"friction"})," in ",(0,r.jsx)(e.code,{children:"<dynamics>"})]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"feet-slip",children:"Feet Slip"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cause"}),": Low friction."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Fix"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Increase ",(0,r.jsx)(e.code,{children:"mu"})," to 1.0-2.0 in foot collision"]}),"\n",(0,r.jsxs)(e.li,{children:["Increase contact stiffness (",(0,r.jsx)(e.code,{children:"kp"}),")"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"noise-models",children:"Noise Models"}),"\n",(0,r.jsx)(e.p,{children:"Real sensors are noisy. Add noise for realism:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<sensor type="ray" name="lidar">\n  <ray>\n    \x3c!-- ... --\x3e\n    <noise>\n      <type>gaussian</type>\n      <mean>0.0</mean>\n      <stddev>0.01</stddev>  \x3c!-- 1 cm noise --\x3e\n    </noise>\n  </ray>\n</sensor>\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Types"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"gaussian"}),": Normal distribution"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"uniform"}),": Random within range"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"performance-real-time-vs-faster",children:"Performance: Real-Time vs. Faster"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Real-time factor"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"RTF = 1.0"}),": 1 sim second = 1 real second"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"RTF < 1.0"}),": Simulation slower than real-time (complex physics)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"RTF > 1.0"}),": Simulation faster (simple scenarios)"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Check RTF"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# In Gazebo GUI, bottom panel shows real-time factor\n# Or monitor /clock topic rate\nros2 topic hz /clock\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Optimize"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Simplify collision geometry"}),"\n",(0,r.jsxs)(e.li,{children:["Increase ",(0,r.jsx)(e.code,{children:"max_step_size"})," (carefully)"]}),"\n",(0,r.jsx)(e.li,{children:"Reduce sensor update rates"}),"\n",(0,r.jsxs)(e.li,{children:["Run headless (",(0,r.jsx)(e.code,{children:"gzserver"})," only, no GUI)"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(e.p,{children:"You've mastered physics simulation in Gazebo. Next, explore Unity for high-fidelity rendering and human-robot interaction."}),"\n",(0,r.jsxs)(e.p,{children:["\ud83d\udc49 ",(0,r.jsx)(e.strong,{children:(0,r.jsx)(e.a,{href:"unity-rendering",children:"Next: Unity Rendering \u2192"})})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.admonition,{title:"Physics Tuning Tips",type:"tip",children:(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Start with default physics"}),": Don't over-tune initially"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Measure real robot"}),": Match inertia, friction to actual hardware"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Iterate"}),": Small changes, test, repeat"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Use visualization"}),": View contacts, forces, CoM in Gazebo"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Validate"}),": Compare simulation to real robot behavior (sim-to-real)"]}),"\n"]})}),"\n",(0,r.jsx)(e.h2,{id:"lab-exercise",children:"Lab Exercise"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Tune physics for stable humanoid standing"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Baseline"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Spawn humanoid, observe if it falls immediately"}),"\n",(0,r.jsx)(e.li,{children:"Record time until fall"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Tune inertia"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Calculate correct inertia for all links"}),"\n",(0,r.jsx)(e.li,{children:"Re-run, check stability improvement"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Tune friction"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Set foot friction to 1.5"}),"\n",(0,r.jsx)(e.li,{children:"Verify no slipping when applying force"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Tune joints"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Add damping (0.7) to leg joints"}),"\n",(0,r.jsx)(e.li,{children:"Test if robot stands more stably"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Measure"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Time to fall should increase significantly"}),"\n",(0,r.jsx)(e.li,{children:"Robot should stand for 10+ seconds without active control"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Bonus"}),": Implement simple balance controller to keep CoM over feet."]})]})}function h(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>o,x:()=>t});var s=i(6540);const r={},l=s.createContext(r);function o(n){const e=s.useContext(l);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),s.createElement(l.Provider,{value:e},n.children)}}}]);