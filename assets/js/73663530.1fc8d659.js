"use strict";(globalThis.webpackChunkrobotics_book=globalThis.webpackChunkrobotics_book||[]).push([[2328],{7789:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>t,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"module3-isaac/nav2-bipedal","title":"Nav2 for Bipedal Humanoids","description":"Path planning and navigation for humanoid robots","source":"@site/docs/module3-isaac/nav2-bipedal.md","sourceDirName":"module3-isaac","slug":"/module3-isaac/nav2-bipedal","permalink":"/module3-isaac/nav2-bipedal","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1764862720000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Nav2 for Bipedal Humanoids","description":"Path planning and navigation for humanoid robots","keywords":["Nav2","navigation","path planning","bipedal","humanoid","obstacle avoidance"]},"sidebar":"tutorialSidebar","previous":{"title":"VSLAM and Navigation","permalink":"/module3-isaac/vslam-navigation"},"next":{"title":"Reinforcement Learning for Robotics","permalink":"/module3-isaac/reinforcement-learning"}}');var o=i(4848),l=i(8453);const s={sidebar_position:4,title:"Nav2 for Bipedal Humanoids",description:"Path planning and navigation for humanoid robots",keywords:["Nav2","navigation","path planning","bipedal","humanoid","obstacle avoidance"]},r="Nav2 for Bipedal Humanoids",t={},c=[{value:"Introduction to Nav2",id:"introduction-to-nav2",level:2},{value:"Why Nav2 for Humanoids?",id:"why-nav2-for-humanoids",level:3},{value:"Nav2 Architecture",id:"nav2-architecture",level:2},{value:"Nav2 for Wheeled vs. Bipedal",id:"nav2-for-wheeled-vs-bipedal",level:2},{value:"Wheeled Robot (Differential Drive)",id:"wheeled-robot-differential-drive",level:3},{value:"Bipedal Humanoid",id:"bipedal-humanoid",level:3},{value:"Simplified Approach: Holonomic Base",id:"simplified-approach-holonomic-base",level:2},{value:"Holonomic Configuration",id:"holonomic-configuration",level:3},{value:"Installing Nav2",id:"installing-nav2",level:2},{value:"Basic Navigation Setup",id:"basic-navigation-setup",level:2},{value:"1. Robot Configuration",id:"1-robot-configuration",level:3},{value:"2. Costmap Configuration",id:"2-costmap-configuration",level:3},{value:"3. Planner Configuration",id:"3-planner-configuration",level:3},{value:"4. Controller Configuration",id:"4-controller-configuration",level:3},{value:"5. Launch Navigation",id:"5-launch-navigation",level:3},{value:"Sending Navigation Goals",id:"sending-navigation-goals",level:2},{value:"Method 1: RViz (Interactive)",id:"method-1-rviz-interactive",level:3},{value:"Method 2: Command Line",id:"method-2-command-line",level:3},{value:"Method 3: Python (Programmatic)",id:"method-3-python-programmatic",level:3},{value:"Waypoint Navigation",id:"waypoint-navigation",level:2},{value:"Humanoid-Specific Challenges",id:"humanoid-specific-challenges",level:2},{value:"Challenge 1: Narrow Footprint",id:"challenge-1-narrow-footprint",level:3},{value:"Challenge 2: Cannot Rotate in Place",id:"challenge-2-cannot-rotate-in-place",level:3},{value:"Challenge 3: Slow Speed",id:"challenge-3-slow-speed",level:3},{value:"Challenge 4: Balance While Turning",id:"challenge-4-balance-while-turning",level:3},{value:"Advanced: Footstep Planning",id:"advanced-footstep-planning",level:2},{value:"Behavior Trees",id:"behavior-trees",level:2},{value:"Monitoring Navigation",id:"monitoring-navigation",level:2},{value:"Check Status",id:"check-status",level:3},{value:"Debugging",id:"debugging",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Lab Exercise",id:"lab-exercise",level:2}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"nav2-for-bipedal-humanoids",children:"Nav2 for Bipedal Humanoids"})}),"\n",(0,o.jsx)(e.h2,{id:"introduction-to-nav2",children:"Introduction to Nav2"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Nav2 (Navigation 2)"})," is ROS 2's navigation framework:"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Path planning (global and local)"}),"\n",(0,o.jsx)(e.li,{children:"Obstacle avoidance"}),"\n",(0,o.jsx)(e.li,{children:"Recovery behaviors"}),"\n",(0,o.jsx)(e.li,{children:"Waypoint following"}),"\n",(0,o.jsx)(e.li,{children:"Dynamic reconfiguration"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"why-nav2-for-humanoids",children:"Why Nav2 for Humanoids?"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Challenge"}),": Humanoids are not wheeled robots."]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Different kinematics (legs, not wheels)"}),"\n",(0,o.jsx)(e.li,{children:"Balance constraints (can't rotate in place)"}),"\n",(0,o.jsx)(e.li,{children:"Footstep planning (discrete foot placements)"}),"\n",(0,o.jsx)(e.li,{children:"Higher center of mass (stability concerns)"}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Solution"}),": Adapt Nav2 for bipedal constraints."]}),"\n",(0,o.jsx)(e.h2,{id:"nav2-architecture",children:"Nav2 Architecture"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Behavior Tree Navigator                        \u2502\n\u2502  - Task coordination                            \u2502\n\u2502  - Recovery behaviors                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Planner Server                                 \u2502\n\u2502  - Global path planning (A*, Dijkstra, etc.)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Controller Server                              \u2502\n\u2502  - Local trajectory generation                  \u2502\n\u2502  - DWB, TEB, MPPI controllers                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Costmap 2D                                     \u2502\n\u2502  - Obstacle representation                      \u2502\n\u2502  - Inflation layer (safety buffer)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(e.h2,{id:"nav2-for-wheeled-vs-bipedal",children:"Nav2 for Wheeled vs. Bipedal"}),"\n",(0,o.jsx)(e.h3,{id:"wheeled-robot-differential-drive",children:"Wheeled Robot (Differential Drive)"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Kinematic model"}),": Simple"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:"dx/dt = v * cos(\u03b8)\ndy/dt = v * sin(\u03b8)\nd\u03b8/dt = \u03c9\n\nCommands: (v, \u03c9) - linear and angular velocity\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Nav2 default"}),": Works out-of-the-box"]}),"\n",(0,o.jsx)(e.h3,{id:"bipedal-humanoid",children:"Bipedal Humanoid"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Kinematic model"}),": Complex"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Footstep planning (discrete positions)"}),"\n",(0,o.jsx)(e.li,{children:"Balance constraints (ZMP, CoM)"}),"\n",(0,o.jsx)(e.li,{children:"Joint limits (hip, knee, ankle ranges)"}),"\n",(0,o.jsx)(e.li,{children:"Stability margins"}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Nav2 adaptation"}),": Need custom controller"]}),"\n",(0,o.jsx)(e.h2,{id:"simplified-approach-holonomic-base",children:"Simplified Approach: Holonomic Base"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"For this course"}),": Treat humanoid as holonomic base."]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Assumption"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Humanoid can move in any direction (forward, backward, strafe)"}),"\n",(0,o.jsx)(e.li,{children:"Low-level controller handles balance"}),"\n",(0,o.jsx)(e.li,{children:"Nav2 sends velocity commands: (vx, vy, vtheta)"}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Justification"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Focus on high-level navigation (path planning)"}),"\n",(0,o.jsx)(e.li,{children:"Low-level walking controller is separate (Module 4)"}),"\n",(0,o.jsx)(e.li,{children:"Practical for simulation (Gazebo, Isaac Sim)"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"holonomic-configuration",children:"Holonomic Configuration"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Nav2 params"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'controller_server:\n  ros__parameters:\n    controller_frequency: 20.0\n    FollowPath:\n      plugin: "dwb_core::DWBLocalPlanner"\n      critics: ["RotateToGoal", "Oscillation", "BaseObstacle", "GoalAlign", "PathAlign", "PathDist", "GoalDist"]\n\n      # Velocity limits (humanoid-specific)\n      max_vel_x: 0.5    # Forward: 0.5 m/s\n      min_vel_x: -0.3   # Backward: 0.3 m/s (slower)\n      max_vel_y: 0.3    # Strafe: 0.3 m/s\n      max_vel_theta: 0.5  # Rotation: 0.5 rad/s\n\n      # Acceleration limits (gentler for stability)\n      acc_lim_x: 0.5\n      acc_lim_y: 0.5\n      acc_lim_theta: 1.0\n\n      # DWB-specific\n      min_speed_xy: 0.1\n      max_speed_xy: 0.5\n      min_speed_theta: 0.2\n'})}),"\n",(0,o.jsx)(e.h2,{id:"installing-nav2",children:"Installing Nav2"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"sudo apt install ros-humble-navigation2 ros-humble-nav2-bringup\n"})}),"\n",(0,o.jsx)(e.h2,{id:"basic-navigation-setup",children:"Basic Navigation Setup"}),"\n",(0,o.jsx)(e.h3,{id:"1-robot-configuration",children:"1. Robot Configuration"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"robot_params.yaml"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'# Robot footprint (humanoid standing)\nrobot_base_frame: "base_link"\nrobot_radius: 0.25  # Circle approximation (50cm diameter)\n# OR\nfootprint: "[[0.2, 0.15], [0.2, -0.15], [-0.2, -0.15], [-0.2, 0.15]]"  # Rectangle\n\n# Transform tolerance\ntransform_tolerance: 0.2\n'})}),"\n",(0,o.jsx)(e.h3,{id:"2-costmap-configuration",children:"2. Costmap Configuration"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Costmap"}),": 2D grid representing obstacle costs."]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"costmap_params.yaml"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'global_costmap:\n  global_costmap:\n    ros__parameters:\n      update_frequency: 1.0\n      publish_frequency: 1.0\n      global_frame: odom\n      robot_base_frame: base_link\n\n      resolution: 0.05  # 5cm per cell\n      width: 50\n      height: 50\n\n      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]\n\n      static_layer:\n        plugin: "nav2_costmap_2d::StaticLayer"\n        map_subscribe_transient_local: True\n\n      obstacle_layer:\n        plugin: "nav2_costmap_2d::ObstacleLayer"\n        enabled: True\n        observation_sources: lidar depth_camera\n\n        lidar:\n          topic: /scan\n          max_obstacle_height: 2.0\n          clearing: True\n          marking: True\n          data_type: "LaserScan"\n\n        depth_camera:\n          topic: /camera/depth/points\n          max_obstacle_height: 2.0\n          clearing: True\n          marking: True\n          data_type: "PointCloud2"\n\n      inflation_layer:\n        plugin: "nav2_costmap_2d::InflationLayer"\n        cost_scaling_factor: 3.0\n        inflation_radius: 0.55  # Safety margin (robot radius + buffer)\n\nlocal_costmap:\n  local_costmap:\n    ros__parameters:\n      update_frequency: 5.0\n      publish_frequency: 2.0\n      global_frame: odom\n      robot_base_frame: base_link\n      rolling_window: true\n\n      width: 5\n      height: 5\n      resolution: 0.05\n\n      plugins: ["obstacle_layer", "inflation_layer"]\n      # (Same obstacle and inflation config as global)\n'})}),"\n",(0,o.jsx)(e.h3,{id:"3-planner-configuration",children:"3. Planner Configuration"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"planner_params.yaml"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'planner_server:\n  ros__parameters:\n    expected_planner_frequency: 1.0\n    planner_plugins: ["GridBased"]\n\n    GridBased:\n      plugin: "nav2_navfn_planner/NavfnPlanner"\n      tolerance: 0.5\n      use_astar: true  # A* (faster than Dijkstra)\n      allow_unknown: true\n'})}),"\n",(0,o.jsx)(e.h3,{id:"4-controller-configuration",children:"4. Controller Configuration"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"controller_params.yaml"})," (already shown above)"]}),"\n",(0,o.jsx)(e.h3,{id:"5-launch-navigation",children:"5. Launch Navigation"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"nav2_launch.py"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\nfrom launch.actions import IncludeLaunchDescription\nfrom ament_index_python.packages import get_package_share_directory\nimport os\n\ndef generate_launch_description():\n    pkg_dir = get_package_share_directory('my_humanoid_nav')\n\n    nav2_params = os.path.join(pkg_dir, 'config', 'nav2_params.yaml')\n\n    return LaunchDescription([\n        # Localization (VSLAM from Module 3)\n        IncludeLaunchDescription(...),\n\n        # Mapping (Nvblox for costmap)\n        Node(\n            package='nvblox_ros',\n            executable='nvblox_node',\n            # ...\n        ),\n\n        # Nav2\n        IncludeLaunchDescription(\n            PythonLaunchDescriptionSource(\n                os.path.join(\n                    get_package_share_directory('nav2_bringup'),\n                    'launch', 'navigation_launch.py'\n                )\n            ),\n            launch_arguments={\n                'params_file': nav2_params,\n                'use_sim_time': 'false',\n            }.items()\n        ),\n\n        # RViz with Nav2 panel\n        Node(\n            package='rviz2',\n            executable='rviz2',\n            arguments=['-d', os.path.join(pkg_dir, 'rviz', 'nav2.rviz')]\n        ),\n    ])\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Run"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"ros2 launch my_humanoid_nav nav2_launch.py\n"})}),"\n",(0,o.jsx)(e.h2,{id:"sending-navigation-goals",children:"Sending Navigation Goals"}),"\n",(0,o.jsx)(e.h3,{id:"method-1-rviz-interactive",children:"Method 1: RViz (Interactive)"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:'1. Open RViz\n2. Panels \u2192 Add New Panel \u2192 Nav2\n3. Click "2D Goal Pose" button\n4. Click on map where you want robot to go\n5. Drag to set orientation\n6. Robot navigates autonomously\n'})}),"\n",(0,o.jsx)(e.h3,{id:"method-2-command-line",children:"Method 2: Command Line"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"ros2 action send_goal /navigate_to_pose nav2_msgs/action/NavigateToPose \"{\n  pose: {\n    header: {frame_id: 'map'},\n    pose: {\n      position: {x: 5.0, y: 2.0, z: 0.0},\n      orientation: {x: 0.0, y: 0.0, z: 0.0, w: 1.0}\n    }\n  }\n}\"\n"})}),"\n",(0,o.jsx)(e.h3,{id:"method-3-python-programmatic",children:"Method 3: Python (Programmatic)"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom nav2_msgs.action import NavigateToPose\nfrom geometry_msgs.msg import PoseStamped\n\nclass NavigationClient(Node):\n    def __init__(self):\n        super().__init__('navigation_client')\n        self._action_client = ActionClient(self, NavigateToPose, 'navigate_to_pose')\n\n    def send_goal(self, x, y, yaw=0.0):\n        goal_msg = NavigateToPose.Goal()\n        goal_msg.pose.header.frame_id = 'map'\n        goal_msg.pose.header.stamp = self.get_clock().now().to_msg()\n        goal_msg.pose.pose.position.x = x\n        goal_msg.pose.pose.position.y = y\n\n        # Convert yaw to quaternion\n        from tf_transformations import quaternion_from_euler\n        q = quaternion_from_euler(0, 0, yaw)\n        goal_msg.pose.pose.orientation.x = q[0]\n        goal_msg.pose.pose.orientation.y = q[1]\n        goal_msg.pose.pose.orientation.z = q[2]\n        goal_msg.pose.pose.orientation.w = q[3]\n\n        self._action_client.wait_for_server()\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        distance_remaining = feedback.distance_remaining\n        self.get_logger().info(f'Distance remaining: {distance_remaining:.2f}m')\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected')\n            return\n\n        self.get_logger().info('Goal accepted')\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info('Navigation complete!')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    nav_client = NavigationClient()\n\n    # Send goal: (5, 2) with 0 degree heading\n    nav_client.send_goal(5.0, 2.0, 0.0)\n\n    rclpy.spin(nav_client)\n"})}),"\n",(0,o.jsx)(e.h2,{id:"waypoint-navigation",children:"Waypoint Navigation"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Visit multiple locations sequentially"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"from nav2_msgs.action import FollowWaypoints\nfrom geometry_msgs.msg import PoseStamped\n\nclass WaypointNavigator(Node):\n    def __init__(self):\n        super().__init__('waypoint_navigator')\n        self._action_client = ActionClient(self, FollowWaypoints, 'follow_waypoints')\n\n    def send_waypoints(self, waypoints):\n        goal_msg = FollowWaypoints.Goal()\n\n        for (x, y, yaw) in waypoints:\n            pose = PoseStamped()\n            pose.header.frame_id = 'map'\n            pose.pose.position.x = x\n            pose.pose.position.y = y\n\n            from tf_transformations import quaternion_from_euler\n            q = quaternion_from_euler(0, 0, yaw)\n            pose.pose.orientation.x = q[0]\n            pose.pose.orientation.y = q[1]\n            pose.pose.orientation.z = q[2]\n            pose.pose.orientation.w = q[3]\n\n            goal_msg.poses.append(pose)\n\n        self._action_client.wait_for_server()\n        self._action_client.send_goal_async(goal_msg)\n        self.get_logger().info(f'Sent {len(waypoints)} waypoints')\n\n# Usage\nnavigator = WaypointNavigator()\nwaypoints = [\n    (2.0, 0.0, 0.0),    # First waypoint\n    (5.0, 2.0, 1.57),   # Second waypoint (facing 90 degrees)\n    (3.0, -1.0, 3.14),  # Third waypoint (facing 180 degrees)\n]\nnavigator.send_waypoints(waypoints)\n"})}),"\n",(0,o.jsx)(e.h2,{id:"humanoid-specific-challenges",children:"Humanoid-Specific Challenges"}),"\n",(0,o.jsx)(e.h3,{id:"challenge-1-narrow-footprint",children:"Challenge 1: Narrow Footprint"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Problem"}),": Humanoid feet are small, but body is tall."]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Solution"}),": Define footprint conservatively:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'# Include shoulders/arms in footprint (top-down view)\nfootprint: "[[0.3, 0.3], [0.3, -0.3], [-0.3, -0.3], [-0.3, 0.3]]"\n'})}),"\n",(0,o.jsx)(e.h3,{id:"challenge-2-cannot-rotate-in-place",children:"Challenge 2: Cannot Rotate in Place"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Problem"}),": Bipedal robots can't spin like wheeled robots."]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Solution"}),": Configure wider turn radius:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:"# Controller parameters\nmin_turning_radius: 0.5  # Meters\nprefer_forward: true\n"})}),"\n",(0,o.jsx)(e.h3,{id:"challenge-3-slow-speed",children:"Challenge 3: Slow Speed"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Problem"}),": Walking is slower than driving."]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Solution"}),": Adjust velocity limits:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:"max_vel_x: 0.5  # 0.5 m/s walking speed\nmax_vel_theta: 0.3  # Slow rotation\n"})}),"\n",(0,o.jsx)(e.h3,{id:"challenge-4-balance-while-turning",children:"Challenge 4: Balance While Turning"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Problem"}),": Sharp turns can cause loss of balance."]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Solution"}),": Smooth trajectory with low acceleration:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:"acc_lim_x: 0.3  # Gentle acceleration\nacc_lim_theta: 0.5\nsim_time: 2.0  # Longer prediction horizon\n"})}),"\n",(0,o.jsx)(e.h2,{id:"advanced-footstep-planning",children:"Advanced: Footstep Planning"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"True bipedal navigation"})," requires footstep planner."]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Concept"}),":"]}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Global planner"}),": Generates coarse path (like wheeled robot)"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Footstep planner"}),": Converts path to discrete foot placements"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Walking controller"}),": Executes footsteps while maintaining balance"]}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Example"}),": Humanoid Footstep Planner"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"class FootstepPlanner(Node):\n    def __init__(self):\n        super().__init__('footstep_planner')\n\n        # Subscribe to Nav2 path\n        self.path_sub = self.create_subscription(\n            Path, '/plan', self.path_callback, 10\n        )\n\n        # Publish footsteps\n        self.footstep_pub = self.create_publisher(\n            FootstepArray, '/footsteps', 10\n        )\n\n    def path_callback(self, path_msg):\n        # Convert path to footsteps\n        footsteps = self.generate_footsteps(path_msg)\n\n        # Publish footstep plan\n        self.footstep_pub.publish(footsteps)\n\n    def generate_footsteps(self, path):\n        footsteps = []\n        step_length = 0.3  # 30cm steps\n        step_width = 0.2   # 20cm apart (left-right)\n\n        left_foot = True\n        for i in range(0, len(path.poses), 2):\n            pose = path.poses[i].pose\n\n            if left_foot:\n                foot_offset = [0, step_width/2]  # Left foot\n            else:\n                foot_offset = [0, -step_width/2]  # Right foot\n\n            # Create footstep (simplified)\n            footstep = Footstep()\n            footstep.position = pose.position\n            footstep.position.y += foot_offset[1]\n            footstep.is_left_foot = left_foot\n\n            footsteps.append(footstep)\n            left_foot = not left_foot\n\n        return footsteps\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Note"}),": Full footstep planning is complex (covered briefly in Module 4)."]}),"\n",(0,o.jsx)(e.h2,{id:"behavior-trees",children:"Behavior Trees"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Nav2 uses behavior trees"})," for task coordination."]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Default behaviors"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"ComputePathToPose"}),": Plan global path"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"FollowPath"}),": Execute path with local controller"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"ClearCostmapExceptRegion"}),": Recovery behavior"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"Spin"}),": Rotate in place (recovery)"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"Wait"}),": Pause (recovery)"]}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Custom behavior tree"})," (advanced):"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-xml",children:'<root main_tree_to_execute="MainTree">\n  <BehaviorTree ID="MainTree">\n    <Sequence>\n      <ComputePathToPose goal="{goal}" path="{path}"/>\n      <FollowPath path="{path}"/>\n    </Sequence>\n  </BehaviorTree>\n</root>\n'})}),"\n",(0,o.jsx)(e.h2,{id:"monitoring-navigation",children:"Monitoring Navigation"}),"\n",(0,o.jsx)(e.h3,{id:"check-status",children:"Check Status"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# Action status\nros2 action list\n\n# Navigation state\nros2 topic echo /navigation_state\n\n# Costmap visualization\nros2 run rviz2 rviz2\n# Add Map display \u2192 /global_costmap/costmap\n"})}),"\n",(0,o.jsx)(e.h3,{id:"debugging",children:"Debugging"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"Navigation fails?"})}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Check costmap"}),": Is path obstructed?"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"ros2 topic echo /global_costmap/costmap --no-arr\n"})}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Check transforms"}),": Is TF tree valid?"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"ros2 run tf2_tools view_frames\nevince frames.pdf\n"})}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Check velocity limits"}),": Are limits too conservative?"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:"max_vel_x: 0.5  # Try increasing\n"})}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Check localization"}),": Is robot localized?"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"ros2 topic echo /visual_slam/tracking/vo_pose_covariance\n# Low covariance = good localization\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsx)(e.p,{children:"You've learned navigation for humanoid robots. Next, explore reinforcement learning for autonomous behavior."}),"\n",(0,o.jsxs)(e.p,{children:["\ud83d\udc49 ",(0,o.jsx)(e.strong,{children:(0,o.jsx)(e.a,{href:"reinforcement-learning",children:"Next: Reinforcement Learning \u2192"})})]}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.admonition,{title:"Nav2 for Humanoids Tips",type:"tip",children:(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Conservative footprint"}),": Include arms/shoulders in 2D footprint"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Slow speeds"}),": Walking < 0.5 m/s for stability"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Gentle acceleration"}),": Avoid sudden changes (balance)"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Wide turns"}),": min_turning_radius to prevent sharp turns"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Test in sim first"}),": Perfect navigation before deploying to hardware"]}),"\n"]})}),"\n",(0,o.jsx)(e.h2,{id:"lab-exercise",children:"Lab Exercise"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Build humanoid navigation system"}),":"]}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Setup Nav2"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Configure costmap with robot footprint"}),"\n",(0,o.jsx)(e.li,{children:"Set velocity limits for walking"}),"\n",(0,o.jsx)(e.li,{children:"Launch Nav2 with custom params"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Test navigation"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Send single goal via RViz"}),"\n",(0,o.jsx)(e.li,{children:"Verify robot reaches goal"}),"\n",(0,o.jsx)(e.li,{children:"Check costmap shows obstacles"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Waypoint navigation"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Define 4-5 waypoints in a loop"}),"\n",(0,o.jsx)(e.li,{children:"Send waypoints sequentially"}),"\n",(0,o.jsx)(e.li,{children:"Robot visits all locations"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Obstacle avoidance"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Place dynamic obstacle in path"}),"\n",(0,o.jsx)(e.li,{children:"Robot should replan and avoid"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Measure performance"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Time to reach goal"}),"\n",(0,o.jsx)(e.li,{children:"Path length vs. optimal path"}),"\n",(0,o.jsx)(e.li,{children:"Number of replanning events"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Bonus"}),": Implement custom recovery behavior (e.g., sidestep if stuck)."]})]})}function h(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>r});var a=i(6540);const o={},l=a.createContext(o);function s(n){const e=a.useContext(l);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),a.createElement(l.Provider,{value:e},n.children)}}}]);